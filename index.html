<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Flixify DLD System</title>
    
    <!-- Fonts & Icons -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;600;700&display=swap" rel="stylesheet">
    
    <!-- JW Player -->
    <script src="https://content.jwplatform.com/libraries/SAHhwvZq.js"></script>
    <script type="text/javascript">jwplayer.key="zTEbSn/eAplL0RLXT030FzOcek6qXmtrxju6Jg==";</script>

    <style>
        /* ===== CSS RESET & BASE ===== */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }
        
        :root {
            --primary: #ff0059;
            --primary-dark: #00eeff;
            --primary-light: rgba(0, 113, 255, 0.2);
            --accent: #00f7ff;
            --text: rgba(255, 255, 255, 0.92);
            --text-light: rgba(255, 255, 255, 0.7);
            --bg: #000000;
            --card-bg: rgba(30, 30, 40, 0.5);
            --border: rgba(255, 255, 255, 0.15);
            --shadow: 0 8px 32px rgba(0, 0, 0, 0.4);
            --radius: 13px;
            --glass: rgba(40, 40, 50, 0.4);
            --glass-highlight: rgba(255, 255, 255, 0.1);
            --glass-edge: rgba(255, 255, 255, 0.05);
        }
        
        body {
            background: var(--bg);
            color: var(--text);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            overflow-x: hidden;
        }
        
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            padding: 20px; 
            flex: 1; 
            z-index: 1; 
        }
        
        /* ===== HEADER STYLES ===== */
        header {
            text-align: center; 
            padding: 50px 30px; 
            margin-bottom: 50px; 
            background: var(--glass);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: var(--radius);
            border: 1px solid var(--glass-edge);
            box-shadow: var(--shadow);
            position: relative; 
            overflow: hidden;
        }
        
        header::before {
            content: ''; 
            position: absolute; 
            top: 0; 
            left: 0; 
            right: 0; 
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--glass-highlight), transparent);
        }
        
        h1 {
            font-size: 3.8rem;
            margin-bottom: 20px;
            font-weight: 800;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -1.5px;
            line-height: 1.1;
            text-shadow: 0 2px 25px rgba(0, 113, 255, 0.2);
        }
        
        .subtitle {
            font-size: 1.4rem;
            color: var(--text-light);
            max-width: 700px;
            margin: 0 auto;
            font-weight: 300;
        }
        
        /* ===== WELCOME MESSAGE ===== */
        .welcome-message {
            text-align: center; 
            padding: 90px 40px; 
            background: var(--glass);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            border-radius: var(--radius);
            margin: 50px 0; 
            border: 1px solid var(--glass-edge);
            box-shadow: var(--shadow);
            transition: all 0.4s ease;
        }
        
        .welcome-message:hover { 
            transform: translateY(-10px) scale(1.02); 
            box-shadow: 0 30px 60px -15px rgba(0, 0, 0, 0.5); 
        }
        
        .welcome-icon { 
            font-size: 6rem; 
            margin-bottom: 35px; 
            color: var(--primary); 
            text-shadow: 0 0 30px var(--primary); 
        }
        
        .welcome-message h2 { 
            font-size: 3rem; 
            margin-bottom: 25px; 
            color: var(--text); 
            font-weight: 700; 
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .welcome-message p { 
            font-size: 1.3rem; 
            color: var(--text-light); 
            max-width: 700px; 
            margin: 0 auto; 
            line-height: 1.8; 
        }
        
        .url-example {
            display: inline-block; 
            margin-top: 25px; 
            padding: 14px 28px; 
            background: rgba(0, 0, 0, 0.25);
            border-radius: var(--radius); 
            font-family: 'Poppins', monospace; 
            color: var(--primary);
            border: 1px solid var(--glass-border); 
            font-weight: 500;
        }
        
        /* ===== MODAL STYLES ===== */
        .modal {
            display: none; 
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8); 
            backdrop-filter: blur(20px); 
            -webkit-backdrop-filter: blur(20px);
            z-index: 1000;
            overflow-y: auto; 
            opacity: 0; 
            transition: opacity 0.4s ease;
            padding: 50px 0; 
            justify-content: center;
            align-items: center;
        }
        
        .modal.show { opacity: 1; display: flex; }
        
        .modal-content {
            background: var(--glass);
            backdrop-filter: blur(20px) saturate(180%);
            -webkit-backdrop-filter: blur(20px) saturate(180%);
            margin: 0 auto;
            padding: 50px 0 50px 0;
            border-radius: var(--radius);
            max-width: 1100px;
            width: 95%; 
            position: relative; 
            border: 1px solid var(--glass-edge);
            box-shadow: var(--shadow);
            transform: scale(0.95); 
            transition: transform 0.4s ease;
        }

        .modal.show .modal-content { transform: scale(1); }
        
        .close-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.15);
            color: var(--text);
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            font-size: 1.2rem;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
        }
        
        .close-btn:hover {
            background: var(--primary);
            transform: rotate(90deg) scale(1.1);
        }

        .modal-inner-padding {
            padding: 0 50px;
        }
        
        .movie-title { 
            font-size: 2.8rem; 
            margin-bottom: 20px; 
            font-weight: 700; 
            color: var(--text); 
            letter-spacing: -1px; 
            line-height: 1.2; 
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .movie-meta { 
            display: flex; 
            gap: 18px; 
            flex-wrap: wrap; 
            margin-bottom: 30px; 
        }
        
        .meta-item {
            display: flex; 
            align-items: center; 
            gap: 10px; 
            font-size: 1.1rem; 
            color: var(--text-light);
            padding: 10px 20px; 
            background: var(--glass);
            border-radius: var(--radius);
            border: 1px solid var(--glass-edge); 
            font-weight: 500;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }
        
        .meta-item:hover { 
            background: var(--glass-highlight); 
            color: var(--text); 
        }
        
        .movie-description { 
            margin-top: 30px; 
            color: var(--text-light); 
            line-height: 1.8; 
            font-size: 1.1rem; 
            font-weight: 400; 
            max-width: 900px; 
        }
        
        /* ===== DOWNLOAD & EMBED SECTIONS ===== */
        .download-section, .embed-section { 
            padding-top: 40px; 
            margin-top: 40px; 
        }
        
        .embed-section, .download-section { 
            border-top: 1px solid var(--glass-border); 
        }

        .section-title {
            font-size: 1.8rem; 
            margin-bottom: 30px; 
            display: flex; 
            align-items: center;
            gap: 15px; 
            color: var(--text); 
            font-weight: 600;
            background: linear-gradient(90deg, var(--primary), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .section-title i { 
            color: var(--primary); 
            font-size: 2rem; 
        }

        /* ===== EPISODE LIST ===== */
        .episode-list { 
            display: flex; 
            flex-direction: column; 
            gap: 12px; 
        }
        
        .episode-item { 
            background: var(--glass); 
            border: 1px solid var(--glass-border); 
            border-radius: var(--radius); 
            overflow: hidden; 
            transition: all 0.3s ease; 
            backdrop-filter: blur(10px);
        }
        
        .episode-item:hover { 
            border-color: var(--primary); 
            transform: translateY(-4px); 
            box-shadow: 0 0 20px rgba(0, 113, 255, 0.3); 
        }
        
        .episode-header { 
            padding: 18px 25px; 
            cursor: pointer; 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            font-weight: 600; 
            font-size: 1.2rem; 
            color: var(--text);
        }
        
        .episode-header .arrow-icon { 
            transition: transform 0.3s ease; 
        }
        
        .episode-item.active .episode-header .arrow-icon { 
            transform: rotate(180deg); 
        }
        
        .episode-links { 
            max-height: 0; 
            overflow: hidden; 
            transition: max-height 0.5s ease, padding 0.5s ease; 
            background: rgba(0,0,0,0.2); 
        }
        
        .episode-item.active .episode-links { 
            max-height: 500px; 
            padding: 25px; 
            border-top: 1px solid var(--glass-border); 
        }
        
        .episode-links .download-card { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            padding: 18px; 
            background: var(--glass); 
            border-radius: var(--radius); 
            transition: all 0.3s ease; 
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-edge);
            position: relative;
            overflow: hidden;
        }
        
        .episode-links .download-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
            transition: left 0.5s;
        }
        
        .episode-links .download-card:hover::before {
            left: 100%;
        }
        
        .episode-links .download-card:hover { 
            background-color: var(--primary-light); 
            transform: translateY(-2px) scale(1.02);
            box-shadow: 0 10px 30px rgba(0, 113, 255, 0.3);
        }
        
        .episode-links .download-card:not(:last-child) { 
            margin-bottom: 12px; 
        }
        
        .download-quality { 
            font-weight: 600; 
            font-size: 1.1rem; 
            color: var(--text); 
        }
        
        /* ===== BUTTON STYLES ===== */
        .download-btn {
            display: inline-flex; 
            align-items: center; 
            gap: 12px; 
            padding: 12px 24px;
            background: var(--glass);
            color: var(--text);
            text-decoration: none; 
            border-radius: var(--radius); 
            font-weight: 700;
            transition: all 0.3s ease; 
            border: 1px solid var(--glass-edge);
            box-shadow: var(--shadow);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        
        .download-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            transition: left 0.5s;
        }
        
        .download-btn:hover::before {
            left: 100%;
        }
        
        .download-btn:hover { 
            transform: translateY(-3px) scale(1.05); 
            background: var(--primary-light);
            box-shadow: 0 8px 30px rgba(0, 113, 255, 0.3); 
        }
        
        .download-btn.locked-btn {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #000;
            box-shadow: 0 4px 20px rgba(255, 215, 0, 0.3);
            animation: pulse 1.5s infinite ease-in-out;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        
        .unlock-stream-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 15px;
            padding: 20px 30px;
            background: linear-gradient(135deg, #ffd700, #ffaa00);
            color: #000000;
            text-decoration: none;
            border-radius: var(--radius);
            font-weight: 700;
            font-size: 1.2rem;
            transition: all 0.3s ease;
            box-shadow: 0 8px 25px rgba(255, 215, 0, 0.4);
            border: none;
            cursor: pointer;
            width: fit-content;
            margin: 30px auto 0;
            animation: pulse 2s infinite ease-in-out;
        }

        .unlock-stream-btn:hover {
            transform: translateY(-5px) scale(1.05);
            box-shadow: 0 12px 35px rgba(255, 215, 0, 0.6);
            animation: none;
        }

        .premium-message {
            text-align: center;
            padding: 40px;
            color: var(--text);
            background: var(--glass);
            border-radius: var(--radius);
            border: 1px solid var(--glass-border);
            line-height: 1.6;
            backdrop-filter: blur(10px);
            box-shadow: var(--shadow);
        }

        .premium-message p {
            font-size: 1.2rem;
            margin-bottom: 20px;
        }

        .premium-message strong {
            color: #FFD700;
            font-weight: 700;
        }

        /* ===== FOOTER ===== */
        footer {
            text-align: center; 
            margin-top: 100px; 
            padding: 40px; 
            color: var(--text-light);
            background: var(--glass);
            border-top: 1px solid var(--glass-border); 
            font-weight: 400;
            backdrop-filter: blur(10px);
        }
        
        /* ===== LOADING & NOTIFICATION ===== */
        .loading { 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            padding: 80px 40px; 
            width: 100%; 
        }
        
        .spinner { 
            width: 60px; 
            height: 60px; 
            border: 4px solid var(--glass-border); 
            border-radius: 50%; 
            border-top: 4px solid var(--primary); 
            animation: spin 1s linear infinite; 
        }
        
        @keyframes spin { 
            0% { transform: rotate(0deg); } 
            100% { transform: rotate(360deg); } 
        }
        
        .notification {
            position: fixed; 
            top: 25px; 
            right: 25px; 
            padding: 18px 28px; 
            background: var(--glass);
            backdrop-filter: blur(15px); 
            border-radius: var(--radius); 
            border: 1px solid var(--glass-border);
            color: var(--text); 
            transform: translateX(120%); 
            opacity: 0;
            transition: all 0.5s cubic-bezier(0.25, 1, 0.5, 1); 
            z-index: 1001; 
            font-weight: 500;
            box-shadow: var(--shadow);
        }
        
        .notification.show { transform: translateX(0); opacity: 1; }
        .notification.error { border-left: 5px solid var(--primary); }
        .notification.success { border-left: 5px solid var(--accent); }
        
        /* ===== EPISODE SELECTOR ===== */
        .episode-selector {
            display: flex; 
            align-items: center; 
            gap: 18px; 
            margin-bottom: 25px; 
            flex-wrap: wrap;
        }
        
        .episode-label { 
            font-weight: 600; 
            color: var(--text); 
            white-space: nowrap; 
            font-size: 1.1rem; 
        }
        
        .custom-select-wrapper { 
            position: relative; 
            min-width: 280px; 
            flex-grow: 1; 
        }

        .episode-dropdown {
            appearance: none; 
            -webkit-appearance: none; 
            -moz-appearance: none;
            width: 100%;
            background-color: var(--glass);
            border: 1px solid var(--primary);
            border-radius: var(--radius);
            padding: 14px 45px 14px 22px;
            color: var(--text);
            font-size: 1.1rem; 
            font-weight: 500; 
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .episode-dropdown:hover { 
            border-color: var(--accent); 
        }
        
        .episode-dropdown:focus { 
            outline: none; 
            border-color: var(--accent); 
        }

        .episode-dropdown option {
            background-color: var(--bg);
            color: var(--text);
            padding: 12px 20px;
        }
        
        /* ===== PLAYER CONTAINER ===== */
        #embedPlayerContainer {
            margin-top: 25px;
            min-height: 200px; 
            background: #000;
            border-radius: var(--radius);
            overflow: hidden;
        }

        .embed-container {
            width: 100%; 
            max-width: 100%; 
            height: 0; 
            padding-bottom: 56.25%;
            position: relative; 
            overflow: hidden;
            border-radius: var(--radius);
        }
        
        .embed-container iframe { 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            border: none; 
        }

        .no-embed, .no-download { 
            text-align: center; 
            padding: 40px; 
            color: var(--text-light); 
            font-style: italic; 
            background: var(--glass); 
            border-radius: var(--radius); 
        }
        
        /* ===== BENGALI TEXT STYLES ===== */
        .download-warning {
           color: #ffd700; 
           font-weight: 700; 
           text-align: center; 
           margin-bottom: 15px; 
           font-size: 22px;
           font-family: 'Hind Siliguri', sans-serif; 
           letter-spacing: 0.5px;
        }

        .download-suggestion {
           color: var(--accent); 
           font-weight: 600; 
           text-align: center; 
           margin-bottom: 20px; 
           font-size: 18px;
           font-family: 'Hind Siliguri', sans-serif; 
           letter-spacing: 0.3px;
        }

        /* ===== TELEGRAM FLOAT ===== */
        .telegram-float { 
            position: fixed; 
            bottom: 25px; 
            right: 25px; 
            z-index: 1000; 
        }

        .telegram-icon {
           width: 52px; 
           height: 52px; 
           border-radius: 50%; 
           background-color: var(--primary); 
           display: flex;
           justify-content: center; 
           align-items: center; 
           animation: pulse 2s ease-out infinite;
           box-shadow: 0 5px 20px rgba(0, 113, 255, 0.6), 
                      inset 0 1px 1px rgba(255, 255, 255, 0.2);
           backdrop-filter: blur(5px);
        }
        
        @keyframes pulse {
           50% { 
               box-shadow: 0 5px 30px rgba(0, 113, 255, 0.9), 
                          inset 0 1px 1px rgba(255, 255, 255, 0.2); 
           }
        }

        .telegram-icon svg { 
            fill: #fff; 
            width: 26px; 
            height: 26px; 
        }

        /* ===== BADGES ===== */
        .recommended-badge {
           color: #fff;
           font-size: 0.75rem;
           font-weight: 600;
           padding: 4px 10px;
           border-radius: 50px;
           margin-left: 10px;
           vertical-align: middle;
           text-shadow: none;
           display: inline-block;
           background: linear-gradient(45deg, var(--primary), var(--accent));
        }

        /* ===== DOWNLOAD OPTIONS ===== */
        .download-option-highlight {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 10px 16px;
            border-radius: 10px;
            transition: all 0.3s ease;
            flex: 1;
        }

        .download-option-highlight.telegram {
            background: linear-gradient(135deg, rgba(0, 136, 204, 0.15), rgba(0, 247, 255, 0.1));
            border: 1px solid rgba(0, 136, 204, 0.3);
            box-shadow: 0 4px 15px rgba(0, 136, 204, 0.2);
        }

        .download-option-highlight.hd-1080p {
            background: linear-gradient(135deg, rgba(255, 215, 0, 0.15), rgba(255, 165, 0, 0.1));
            border: 1px solid rgba(255, 215, 0, 0.3);
            box-shadow: 0 4px 15px rgba(255, 215, 0, 0.2);
        }

        .download-option-highlight.hd-720p {
            background: linear-gradient(135deg, rgba(0, 255, 0, 0.15), rgba(144, 238, 144, 0.1));
            border: 1px solid rgba(0, 255, 0, 0.3);
            box-shadow: 0 4px 15px rgba(0, 255, 0, 0.2);
        }

        .download-option-highlight.backup {
            background: linear-gradient(135deg, rgba(138, 43, 226, 0.15), rgba(147, 112, 219, 0.1));
            border: 1px solid rgba(138, 43, 226, 0.3);
            box-shadow: 0 4px 15px rgba(138, 43, 226, 0.2);
        }

        .download-option-highlight .emoji {
            font-size: 1.4rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
        }

        .download-option-highlight .quality-badge {
            font-weight: 700;
            font-size: 1rem;
            color: var(--text);
            text-shadow: 0 1px 2px rgba(0,0,0,0.5);
        }

        .download-option-highlight.telegram .quality-badge {
            color: #66d9ff;
        }

        .download-option-highlight.hd-1080p .quality-badge {
            color: #ffd700;
        }

        .download-option-highlight.hd-720p .quality-badge {
            color: #90ee90;
        }

        .download-option-highlight .size-info {
            font-size: 0.85rem;
            color: var(--text-light);
            margin-left: auto;
            background: rgba(0,0,0,0.3);
            padding: 4px 8px;
            border-radius: 6px;
            font-weight: 500;
        }

        .download-option-highlight .server-badge {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
        }

        .download-option-highlight.telegram .server-badge {
            background: linear-gradient(135deg, #0088cc, #00ccff);
        }

        .download-option-highlight.hd-1080p .server-badge {
            background: linear-gradient(135deg, #ffd700, #ffaa00);
        }

        .download-option-highlight.hd-720p .server-badge {
            background: linear-gradient(135deg, #00cc00, #66ff66);
        }

        /* ===== EPISODE HEADER ===== */
        .episode-header-with-emoji {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .episode-emoji {
            font-size: 1.5rem;
            filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3));
            animation: float 3s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-3px); }
        }

        .episode-header-text {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .episode-main-text {
            font-weight: 700;
            font-size: 1.1rem;
            color: var(--text);
        }

        .episode-sub-text {
            font-size: 0.85rem;
            color: var(--text-light);
            font-weight: 500;
        }

        /* ===== DOWNLOAD STATS ===== */
        .download-stats {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.8rem;
            color: var(--text-light);
            margin-top: 5px;
        }

        .download-count {
            display: flex;
            align-items: center;
            gap: 4px;
            background: rgba(255,255,255,0.1);
            padding: 2px 8px;
            border-radius: 10px;
        }

        /* ===== QUALITY INDICATORS ===== */
        .quality-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            margin-top: 5px;
        }

        .quality-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
        }

        .quality-dot.hd {
            background: #00ff00;
            box-shadow: 0 0 8px #00ff00;
        }

        .quality-dot.fhd {
            background: #ffd700;
            box-shadow: 0 0 8px #ffd700;
        }

        .quality-dot.uhd {
            background: #ff4444;
            box-shadow: 0 0 8px #ff4444;
        }

        /* ===== SPEED INDICATOR ===== */
        .speed-indicator {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.75rem;
            color: var(--accent);
            margin-top: 3px;
        }

        /* ===== SERVER STATUS ===== */
        .server-status {
            display: flex;
            align-items: center;
            gap: 4px;
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 8px;
            background: rgba(0, 255, 0, 0.1);
            color: #00ff00;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }

        .server-status.offline {
            background: rgba(255, 0, 0, 0.1);
            color: #ff4444;
            border: 1px solid rgba(255, 0, 0, 0.3);
        }

        /* ===== JW PLAYER CUSTOM SKIN ===== */
        .jwplayer {
            border-radius: var(--radius) !important;
            overflow: hidden !important;
        }
        
        .jw-skin-flixify .jw-controls {
            background: linear-gradient(to top, rgba(0,0,0,0.8), transparent) !important;
        }
        
        .jw-skin-flixify .jw-button-color {
            color: var(--primary) !important;
        }
        
        .jw-skin-flixify .jw-progress {
            background: rgba(255,255,255,0.2) !important;
        }
        
        .jw-skin-flixify .jw-slider-horizontal .jw-rail {
            background: rgba(255,255,255,0.2) !important;
        }
        
        .jw-skin-flixify .jw-slider-horizontal .jw-buffer {
            background: rgba(255,255,255,0.4) !important;
        }
        
        .jw-skin-flixify .jw-slider-horizontal .jw-progress {
            background: var(--primary) !important;
        }
        
        .jw-skin-flixify .jw-slider-horizontal .jw-knob {
            background: var(--accent) !important;
        }
        
        .jw-skin-flixify .jw-time-tip {
            background: var(--glass) !important;
            backdrop-filter: blur(10px) !important;
            border: 1px solid var(--glass-edge) !important;
            color: var(--text) !important;
        }

        /* ===== RESPONSIVE DESIGN ===== */
        @media (max-width: 768px) {
            .modal-content { padding: 30px 0; }
            .modal-inner-padding { padding: 0 20px; }
            .modal { padding: 20px 0; }
            .movie-title { font-size: 2.2rem; }
            .episode-links .download-card { flex-direction: column; align-items: flex-start; gap: 15px; }
            .download-btn { align-self: stretch; justify-content: center; }
            h1 { font-size: 2.8rem; }
            .subtitle { font-size: 1.2rem; }
            .download-option-highlight { flex-wrap: wrap; }
            .episode-header-with-emoji { flex-direction: column; align-items: flex-start; gap: 8px; }
            .premium-download-buttons { flex-direction: column; align-items: center; gap: 10px !important; }
            .premium-download-buttons .unlock-stream-btn { width: 100%; }
            
            /* Mobile specific adjustments */
            #embedPlayerContainer {
                margin-top: 5px !important;
                min-height: 150px !important;
            }

            .embed-section {
                margin-top: 10px !important;
                padding-top: 10px !important;
            }

            .modal-content {
                padding-top: 10px !important;
                padding-bottom: 10px !important;
            }

            .modal-inner-padding {
                padding-left: 10px !important;
                padding-right: 10px !important;
            }

            .unlock-stream-btn {
                margin-top: 10px !important;
                margin-bottom: 10px !important;
            }
        }
    </style>
</head>
<body>
    
    <!-- ===== MAIN CONTAINER ===== -->
    <div class="container">
        <header>
            <h1>Flixify Download System</h1>
            <p class="subtitle">Download your favorite movies in high quality</p>
        </header>
        
        <div id="welcomeMessage" class="welcome-message">
            <div class="welcome-icon"><i class="fas fa-film"></i></div>
            <h2>Welcome!</h2>
            <p>Visit our movie site. The link is provided below!</p>
            <div class="url-example">flixify.jhtone.site</div>
        </div>
    </div>
    
    <!-- ===== MOVIE DETAILS MODAL ===== -->
    <div id="movieModal" class="modal">
        <div class="modal-content">
            <div id="modalBody"></div>
        </div>
    </div>
    
    <!-- ===== NOTIFICATION ===== -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>
    
    <!-- ===== FOOTER ===== -->
    <footer>
        <p>¬© 2025 Flixify Team! | All Rights Reserved!</p>
    </footer>

    <!-- ===== TELEGRAM FLOAT BUTTON ===== -->
    <a href="https://t.me/flixify_official_group" target="_blank" class="telegram-float">
        <div class="telegram-icon">
            <svg viewBox="0 0 64 64">
                <path d="M56.4,8.2l-51.2,20c-1.7,0.6-1.6,3,0.1,3.5l9.7,2.9c2.1,0.6,3.8,2.2,4.4,4.3l3.8,12.1c0.5,1.6,2.5,2.1,3.7,0.9 l5.2-5.3c0.9-0.9,2.2-1,3.2-0.3l11.5,8.4c1.6,1.2,3.9,0.3,4.3-1.7l8.7-41.8C60.4,9.1,58.4,7.4,56.4,8.2z M50,17.4L29.4,35.6 c-1.1,1-1.9,2.4-2,3.9c-0.2,1.5-2.3,1.7-2.8,0.3l-0.9-3c-0.7-2.2,0.2-4.5,2.1-5.7l23.5-14.6C49.9,16.1,50.5,16.9,50,17.4z"></path>
            </svg>
        </div>
    </a>

    <!-- ===== JAVASCRIPT ===== -->
    <script>
        // ===== GLOBAL VARIABLES =====
        const API_URL = 'https://script.google.com/macros/s/AKfycbygyIww9tzNT3Pga-ghd5tvnQhDPuunwJCNNJNx2Fkvbj4SSsYgbgFbYV3LE09YBYl0/exec';
        const modal = document.getElementById('movieModal');
        let player = null;
        let currentMovieId = null;
        const downloadUnlockUrl = 'https://contractexcitedly.com/a10riqnm?key=562bf326fa21da046160a7c816701951';
        const premiumPurchaseUrl = 'https://offer.prm.flixify.jhtone.site/';
        const adminReferrers = ['https://prm.flixify.jhtone.site/', 'https://prm.flixify.18plus.jhtone.site/'];
        const isFromPremiumSite = adminReferrers.some(referrer => document.referrer.startsWith(referrer));
        let isDownloadUnlocked = isFromPremiumSite;
        let jwSaveListener = null;
        let jwTimeInterval = null;

        // ===== MODAL FUNCTIONS =====
        function closeModal(modalId) {
            const targetModal = document.getElementById(modalId);
            if (targetModal) {
                targetModal.classList.remove('show');
                setTimeout(() => targetModal.style.display = 'none', 400);
            }
        }

        // ===== KEYBOARD SHORTCUTS =====
        document.addEventListener('keydown', function(e) {
            // Media controls for JW Player
            if (modal.style.display === 'block' && player && typeof player.getState === 'function') {
                if (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') {
                    return;
                }
                
                if (e.code === 'Space' && document.activeElement && document.activeElement.tagName === 'BUTTON') {
                    return;
                }

                switch(e.code) {
                    case 'ArrowRight':
                        e.preventDefault();
                        player.seek(player.getPosition() + 10);
                        break;
                    case 'ArrowLeft':
                        e.preventDefault();
                        player.seek(Math.max(0, player.getPosition() - 10));
                        break;
                    case 'Space':
                        e.preventDefault();
                        if (player.getState() === 'playing') {
                            player.pause();
                        } else {
                            player.play();
                        }
                        break;
                }
            }
        });

        // ===== PAGE LOAD =====
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const movieId = urlParams.get('id');
            if (movieId) {
                loadMovieDetails(movieId);
                window.history.replaceState({}, document.title, window.location.pathname);
            }
        });

        // ===== NOTIFICATION SYSTEM =====
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            notificationText.textContent = message;
            notification.className = `notification ${type} show`;
            setTimeout(() => { notification.classList.remove('show'); }, 4000);
        }

        // ===== LOAD MOVIE DETAILS =====
        function loadMovieDetails(id) {
            currentMovieId = id;
            const modalBody = document.getElementById('modalBody');
            modalBody.innerHTML = `<div class="loading"><div class="spinner"></div></div>`;
            modal.style.display = 'block';
            setTimeout(() => modal.classList.add('show'), 10);
            
            fetch(`${API_URL}?id=${id}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    if (!data) {
                        throw new Error('No data received from server');
                    }
                    if (data.error) {
                        showError(data.error);
                        showNotification(`Error: ${data.error}`, 'error');
                    } else {
                        openMovieModal(data);
                        showNotification('Movie loaded successfully!', 'success');
                    }
                })
                .catch(error => {
                    console.error('Fetch error:', error);
                    showError(`Network error: ${error.message}`);
                    showNotification('Failed to load movie', 'error');
                });
        }

        // ===== VIDEO LINK VALIDATION =====
        function isDirectVideoLink(url) {
            if (typeof url !== 'string') return false;
            const lowerCaseUrl = url.toLowerCase();
            
            if (lowerCaseUrl.includes('/stream?id=') || lowerCaseUrl.includes('workers.dev/stream')) {
                return true;
            }
            
            return lowerCaseUrl.endsWith('.mp4') || lowerCaseUrl.endsWith('.mkv') || lowerCaseUrl.endsWith('.webm');
        }

        function getOkVideoId(url) {
            const match = url.match(/(?:\/video\/|\/videoembed\/)(\d+)/);
            return match ? match[1] : null;
        }

        // ===== EMBED/IFRAME CREATION =====
        const createIframe = (link) => {
            let iframeSrc = link;
            if (link.includes('ok.ru')) {
                const videoId = getOkVideoId(link);
                iframeSrc = videoId ? `https://ok.ru/videoembed/${videoId}` : link;
            }
            return `<div class="embed-container"><iframe src="${iframeSrc}" frameborder="0" allowfullscreen></iframe></div>`;
        };

        // ===== PLAYER MANAGEMENT =====
        function removePlayer() {
            const container = document.querySelector('#embedPlayerContainer');
            if (player) {
                try {
                    player.remove();
                } catch (e) {
                    console.warn("Could not remove previous player instance:", e);
                }
                player = null;
            }
            if (container) {
                container.innerHTML = '';
            }
        }

        function renderPlayer(containerSelector, link, thumbnailUrl) {
            const container = document.querySelector(containerSelector);
            if (!container) return;
            
            container.style.display = 'block'; 

            if (player) {
                try {
                    player.remove();
                } catch (e) {
                    console.warn("Player removal warning:", e);
                }
                player = null;
            }

            if (isDirectVideoLink(link)) {
                container.innerHTML = `<div id="jwplayer-video" style="border-radius: 15px; overflow: hidden;"></div>`;
                
                try {
                    player = jwplayer("jwplayer-video");
                    player.setup({
                        file: link,
                        type: 'video/mp4',
                        image: thumbnailUrl || "",
                        aspectratio: "16:9",
                        autostart: false,
                        controls: true,
                        primary: "html5",
                        logo: {
                            file: "https://drive.google.com/thumbnail?id=1otiMKTEhxQZe2xxQDs0-KShH9hNJlrjF&sz=w1000",
                            position: "top-left"
                        },
                        skin: {
                            name: "flixify",
                            active: "#ff0059",
                            inactive: "#00f7ff",
                            background: "rgba(0,0,0,0.8)"
                        }
                    });

                } catch (err) {
                    console.error("JWPlayer initialization failed:", err);
                    container.innerHTML = `<div class="no-embed"><p>Error loading premium player.</p></div>`;
                }
            } else {
                container.innerHTML = createIframe(link);
            }
        }
       
        // ===== OPEN MOVIE MODAL =====
        function openMovieModal(movie) {
            if (!movie) {
                showError('No movie data available');
                return;
            }

            const modalBody = document.getElementById('modalBody');
            const welcomeMessage = document.getElementById('welcomeMessage');
            if (welcomeMessage) {
                welcomeMessage.style.display = 'none';
            }

            let embedHtml = '';
            
            if (movie.EMBED_LINK && typeof movie.EMBED_LINK === 'string') {
                const embedLinks = movie.EMBED_LINK.split(',').map(l => l ? l.trim() : '');
                const embedNames = movie.EMBED_NAME ? 
                    movie.EMBED_NAME.split(',').map(n => n ? n.trim() : '') : 
                    embedLinks.map((_, i) => `Server ${i + 1}`);

                let episodeSelectorHtml = '';
                
                if (embedLinks.length >= 1) { 
                    let episodeOptions = embedNames.map((name, index) => 
                        `<option value="${index}" data-link="${embedLinks[index]}">${name || `Server ${index + 1}`}</option>`
                    ).join('');
                    episodeSelectorHtml = `
                        <div class="episode-selector">
                            <span class="episode-label">Select :</span>
                            <div class="custom-select-wrapper">
                                <select class="episode-dropdown" id="episodeDropdown">${episodeOptions}</select>
                            </div>
                        </div>`;
                }

                if (isFromPremiumSite) {
                    embedHtml = `
                        <div class="embed-section">
                            <div class="modal-inner-padding">
                                <h3 class="section-title"><i class="fas fa-play-circle"></i> Online Watch</h3>
                                ${episodeSelectorHtml}
                            </div>
                            <div id="embedPlayerContainer" style="margin-top: 20px; min-height: 500px; padding: 0;"></div>
                        </div>`;
                        
                } else {
                    embedHtml = `
                        <div class="embed-section">
                            <div class="modal-inner-padding">
                                <h3 class="section-title"><i class="fas fa-play-circle"></i> Online Watch</h3>
                                <div class="premium-message">
                                    <p><strong>‚ö†Ô∏è Only premium users can watch this video. ‚ö†Ô∏è</strong></p>
                                    <p>To unlock video streaming, please upgrade to a premium account.</p>
                                    <button onclick="window.open('${premiumPurchaseUrl}', '_blank')" class="unlock-stream-btn" style="margin-top: 30px;"><i class="fas fa-crown"></i> Buy Premium</button>
                                </div>
                            </div>
                        </div>`;
                }
            } else {
                 embedHtml = `
                     <div class="embed-section">
                         <div class="modal-inner-padding">
                             <h3 class="section-title"><i class="fas fa-play-circle"></i> Online Watch</h3>
                             <div class="no-embed"><p>No streaming link available.</p></div>
                         </div>
                     </div>`;
            }
            
            let downloadLinksHtml = '';
            
            if (movie.DOWNLOAD_LINK && movie.LINK_NAME && 
                typeof movie.DOWNLOAD_LINK === 'string' && 
                typeof movie.LINK_NAME === 'string') {
                
                const links = movie.DOWNLOAD_LINK.split(',').map(link => link ? link.trim() : '');
                const names = movie.LINK_NAME.split(',').map(name => name ? name.trim() : '');
                const episodeGroups = {};
                
                names.forEach((name, index) => {
                    const episodeName = name || `Download ${index + 1}`;
                    const isPremiumEpisode = episodeName.toLowerCase().includes('[premium]') || 
                                                   episodeName.toLowerCase().includes('premium');
                    const isWithAds = episodeName.toLowerCase().includes('with ads') || 
                                                   episodeName.toLowerCase().includes('ads');
                    
                    if (!isFromPremiumSite && isPremiumEpisode) {
                        return; 
                    }
                    
                    if (isFromPremiumSite && isWithAds) {
                        return; 
                    }
                    
                    if (!episodeGroups[episodeName]) episodeGroups[episodeName] = [];
                    episodeGroups[episodeName].push({ 
                        quality: 'Download', 
                        link: links[index] || '' 
                    });
                });
                
                downloadLinksHtml = Object.entries(episodeGroups).map(([episodeName, qualities], index) => {
                    const hasNonWorkingLinks = qualities.some(q => q.link && q.link.trim().startsWith('#'));
                    let statusBadge = hasNonWorkingLinks ? '<span class="not-working-header-badge">Not working</span>' : (index === 0 ? '<span class="recommended-badge">Recommended</span>' : '');
                    
                    let episodeEmoji = 'üí´';
                    let qualityClass = '';
                    let subText = '';
                    const isPremiumEpisode = episodeName.toLowerCase().includes('[premium]') || 
                                                   episodeName.toLowerCase().includes('premium');
                    
                    if (episodeName.toLowerCase().includes('telegram')) {
                        episodeEmoji = 'üöÄ';
                        qualityClass = 'telegram';
                        subText = 'Fast & Secure Download';
                    } else if (episodeName.toLowerCase().includes('1080p')) {
                        episodeEmoji = 'üéØ';
                        qualityClass = 'hd-1080p';
                        subText = 'Full HD ‚Ä¢ Crystal Clear';
                    } else if (episodeName.toLowerCase().includes('720p')) {
                        episodeEmoji = '‚ö°';
                        qualityClass = 'hd-720p';
                        subText = 'HD Ready ‚Ä¢ Balanced Quality';
                    } else if (episodeName.toLowerCase().includes('backup')) {
                        episodeEmoji = 'üõ°Ô∏è';
                        qualityClass = 'backup';
                        subText = 'Alternative Mirror';
                    } else if (episodeName.toLowerCase().includes('download')) {
                        episodeEmoji = 'üì•';
                        subText = 'Direct Download';
                    } else if (isPremiumEpisode) {
                        episodeEmoji = 'üëë';
                        qualityClass = 'premium';
                        subText = 'Premium Exclusive Content';
                    }

                    const qualityLinks = qualities.map(q => {
                        const isNotWorking = q.link && q.link.trim().startsWith('#');
                        const is1080p = episodeName.toLowerCase().includes('1080p');
                        const isPremiumEpisodeLink = episodeName.toLowerCase().includes('[premium]') || episodeName.toLowerCase().includes('premium');
                        
                        let isThisButtonUnlocked;

                        if (isFromPremiumSite) {
                            isThisButtonUnlocked = true;
                        } else {
                            isThisButtonUnlocked = false; 
                            
                            if (is1080p || isPremiumEpisodeLink) {
                                   isThisButtonUnlocked = false;
                            } else {
                                const buttonIdCheck = `btn_${btoa(q.link).slice(0, 16)}`;
                                if (sessionStorage.getItem(buttonIdCheck) === 'true') {
                                    isThisButtonUnlocked = true;
                                }
                            }
                        }
                        
                        const buttonId = `btn_${btoa(q.link).slice(0, 16)}`;
                        
                        let buttonText, buttonIcon, premiumAttribute = '';
                        
                        if (isThisButtonUnlocked) {
                            buttonText = 'Download Now';
                            buttonIcon = 'fas fa-download';
                        } else if (is1080p || isPremiumEpisodeLink) {
                            buttonText = 'Premium Only';
                            buttonIcon = 'fas fa-lock';
                            premiumAttribute = 'data-premium="true"';
                        } else {
                            buttonText = 'Unlock Access';
                            buttonIcon = 'fas fa-lock';
                        }
                        
                        const buttonClass = isThisButtonUnlocked ? 'download-btn' : 'download-btn locked-btn';
                        
                        let qualityDisplayHtml = '';
                        if (episodeName.toLowerCase().includes('telegram')) {
                            qualityDisplayHtml = `
                                <div class="download-option-highlight ${qualityClass}">
                                    <span class="emoji">üöÄ</span>
                                    <i class="fab fa-telegram-plane" style="color: #66d9ff; font-size: 1.3rem;"></i>
                                    <div>
                                        <div class="quality-badge">Telegram Channel</div>
                                        <div class="download-stats">
                                            <span class="download-count">üî• High Speed Downloads</span>
                                            <span>‚Ä¢</span>
                                            <span class="server-status">üü¢ Online</span>
                                        </div>
                                        <div class="speed-indicator">
                                            <i class="fas fa-bolt"></i>
                                            <span>High Speed</span>
                                        </div>
                                    </div>
                                    <span class="size-info">Fastest Option</span>
                                    <span class="server-badge">Premium</span>
                                </div>
                            `;
                        } else if (episodeName.toLowerCase().includes('1080p')) {
                            qualityDisplayHtml = `
                                <div class="download-option-highlight ${qualityClass}">
                                    <span class="emoji">üéØ</span>
                                    <div>
                                        <div class="quality-badge">1080p FHD</div>
                                        <div class="quality-indicator">
                                            <div class="quality-dot fhd"></div>
                                            <div class="quality-dot fhd"></div>
                                            <div class="quality-dot fhd"></div>
                                            <span style="font-size: 0.8rem; margin-left: 5px;">Ultra Quality</span>
                                        </div>
                                        <div class="speed-indicator">
                                            <i class="fas fa-download"></i>
                                            <span>Fast Download</span>
                                        </div>
                                    </div>
                                    <span class="size-info">FHD Quality</span>
                                    <span class="server-badge">FHD</span>
                                </div>
                            `;
                        } else if (episodeName.toLowerCase().includes('720p')) {
                            qualityDisplayHtml = `
                                <div class="download-option-highlight ${qualityClass}">
                                    <span class="emoji">‚ö°</span>
                                    <div>
                                        <div class="quality-badge">720p HD</div>
                                        <div class="quality-indicator">
                                            <div class="quality-dot hd"></div>
                                            <div class="quality-dot hd"></div>
                                            <div class="quality-dot"></div>
                                            <span style="font-size: 0.8rem; margin-left: 5px;">High Quality</span>
                                        </div>
                                        <div class="speed-indicator">
                                            <i class="fas fa-download"></i>
                                            <span>Fast Download</span>
                                        </div>
                                    </div>
                                    <span class="size-info">HD Quality</span>
                                    <span class="server-badge">HD</span>
                                </div>
                            `;
                        } else if (episodeName.toLowerCase().includes('backup')) {
                            qualityDisplayHtml = `
                                <div class="download-option-highlight ${qualityClass}">
                                    <span class="emoji">üõ°Ô∏è</span>
                                    <div>
                                        <div class="quality-badge">Backup Server</div>
                                        <div class="download-stats">
                                            <span class="download-count">üîÑ Alternative</span>
                                            <span>‚Ä¢</span>
                                            <span class="server-status">üü¢ Online</span>
                                        </div>
                                        <div class="speed-indicator">
                                            <i class="fas fa-shield-alt"></i>
                                            <span>Reliable</span>
                                        </div>
                                    </div>
                                    <span class="size-info">Reliable</span>
                                    <span class="server-badge">Backup</span>
                                </div>
                            `;
                        } else if (isPremiumEpisodeLink) {
                            qualityDisplayHtml = `
                                <div class="download-option-highlight premium">
                                    <span class="emoji">üëë</span>
                                    <div>
                                        <div class="quality-badge" style="color: #FFD700;">Premium Quality</div>
                                        <div class="download-stats">
                                            <span class="download-count">‚≠ê Exclusive Content</span>
                                            <span>‚Ä¢</span>
                                            <span class="server-status">üü¢ Online</span>
                                        </div>
                                        <div class="speed-indicator">
                                            <i class="fas fa-crown"></i>
                                            <span>Premium Speed</span>
                                        </div>
                                    </div>
                                    <span class="size-info">Premium Only</span>
                                    <span class="server-badge" style="background: linear-gradient(135deg, #FFD700, #FFA500);">PREMIUM</span>
                                </div>
                            `;
                        } else {
                            qualityDisplayHtml = `
                                <div class="download-option-highlight">
                                    <span class="emoji">üí´</span>
                                    <div>
                                        <div class="quality-badge">${episodeName}</div>
                                        <div class="download-stats">
                                            <span class="download-count">üì• Direct Download</span>
                                            <span class="server-status">üü¢ Online</span>
                                        </div>
                                        <div class="speed-indicator">
                                            <i class="fas fa-download"></i>
                                            <span>Standard Speed</span>
                                        </div>
                                    </div>
                                    <span class="size-info">Standard</span>
                                    <span class="server-badge">Direct</span>
                                </div>
                            `;
                        }

                        let linkContent;
                        if (isNotWorking) {
                            linkContent = `<span style="padding: 10px 15px; background: rgba(255, 27, 75, 0.1); border: 1px solid var(--accent-red); border-radius: 12px; color: var(--accent-red); font-weight: 600; font-size: 0.9rem; cursor: not-allowed;">üö´ Temporarily Unavailable</span>`;
                        } else {
                            const buttonHtml = `<a href="#" id="${buttonId}" data-download-url="${q.link}" class="${buttonClass}" ${premiumAttribute}><i class="${buttonIcon}"></i> ${buttonText}</a>`;
                            
                            if (!isThisButtonUnlocked && (is1080p || isPremiumEpisodeLink)) {
                                linkContent = `
                                    <div style="display: flex; align-items: center; gap: 10px; flex-wrap: wrap; justify-content: flex-end;">
                                        <span style="display: inline-flex; align-items: center; gap: 5px; padding: 5px 10px; background: rgba(255, 27, 75, 0.1); border: 1px solid var(--accent-red); border-radius: 8px; color: var(--accent-red); font-weight: 500; font-size: 0.8rem; font-style: italic;">
                                            <i class="fas fa-crown" style="font-size: 0.7rem;"></i> Premium Exclusive Content
                                        </span>
                                        ${buttonHtml}
                                    </div>
                                `;
                            } else {
                                linkContent = buttonHtml;
                            }
                        }

                        return `<div class="download-card"><div style="display: flex; align-items: center; gap: 10px; flex: 1;">${qualityDisplayHtml}</div>${linkContent}</div>`;
                    }).join('');

                    return `<div class="episode-item ${index === 0 ? 'active' : ''}">
                        <div class="episode-header">
                            <div class="episode-header-with-emoji">
                                <span class="episode-emoji">${episodeEmoji}</span>
                                <div class="episode-header-text">
                                    <div class="episode-main-text">${episodeName} ${statusBadge}</div>
                                    <div class="episode-sub-text">${subText}</div>
                                </div>
                            </div>
                            <i class="fas fa-chevron-down arrow-icon"></i>
                        </div>
                        <div class="episode-links">${qualityLinks}</div>
                    </div>`;
                }).join('');
            } else {
                downloadLinksHtml = '<div class="no-download"><p>No download links available.</p></div>';
            }

            modalBody.innerHTML = `
                <div class="modal-inner-padding"> 
                    <div class="download-warning">‚ö†Ô∏è ‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶Ø‡ßá ‡¶ï‡ßã‡¶®‡ßã ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶•‡ßá‡¶ï‡ßá ‡¶°‡¶æ‡¶â‡¶®‡¶≤‡ßã‡¶° ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‡¶è‡¶ï‡¶ü‡¶ø ‡¶ï‡¶æ‡¶ú ‡¶®‡¶æ ‡¶ï‡¶∞‡¶≤‡ßá ‡¶Ö‡¶®‡ßç‡¶Ø ‡¶≤‡¶ø‡¶Ç‡¶ï ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§ ‚ö†Ô∏è</div>
                    <div class="download-suggestion">üí° Note : Use Download Manager Like IDM Or IDA For ‚ö° Instant download! üí°</div>
                    <h2 class="movie-title">${movie.MOVIE_NAME || 'Unknown Movie'}</h2>
                    <div class="movie-meta">
                        ${movie.MOVIE_TYPE ? `<div class="meta-item"><i class="fas fa-film"></i><span>${movie.MOVIE_TYPE}</span></div>` : ''}
                        ${movie.VIEW_COUNT ? `<div class="meta-item"><i class="fas fa-eye"></i><span>${movie.VIEW_COUNT.toLocaleString()} Views</span></div>` : ''}
                    </div>
                    ${movie.DESCRIPTION ? `<p class="movie-description">${movie.DESCRIPTION}</p>` : ''}
                </div>
                ${embedHtml}
                <div class="download-section">
                    <div class="modal-inner-padding">
                        <h3 class="section-title"><i class="fas fa-download"></i> Download Options</h3>
                        <div class="episode-list">${downloadLinksHtml}</div>
                    </div>
                </div>`;
            
            if (movie.ID) {
                console.log(`Movie ID ${movie.ID} loaded. Triggering background view count update.`);
                
                fetch(`${API_URL}?action=updateView&id=${movie.ID}`, { 
                    method: 'GET',
                    cache: 'no-cache'
                })
                .then(response => {
                    if (response.ok) {
                        console.log('View count update triggered successfully (background task).');
                    } else {
                        console.warn('Failed to trigger view count update.');
                    }
                })
                .catch(err => console.error('Error during view count update:', err));
            }
            
            if (isFromPremiumSite && movie.EMBED_LINK && typeof movie.EMBED_LINK === 'string') {
                const embedLinks = movie.EMBED_LINK.split(',').map(l => l ? l.trim() : '');
                const episodeDropdown = modalBody.querySelector('#episodeDropdown');
                
                const updatePlayerAndButton = () => {
                    if (embedLinks.length > 0) {
                        const selectedIndex = episodeDropdown ? episodeDropdown.value : 0;
                        const selectedOption = episodeDropdown ? episodeDropdown.options[selectedIndex] : null;
                        const link = embedLinks[selectedIndex];
                        
                        renderPlayer('#embedPlayerContainer', link, movie.THUMBNAIL_URL); 
                    }
                };

                if (episodeDropdown) {
                    episodeDropdown.addEventListener('change', updatePlayerAndButton);
                }
                
                updatePlayerAndButton();
            }
            
            const episodeItems = modalBody.querySelectorAll('.episode-item');
            episodeItems.forEach(item => {
                const header = item.querySelector('.episode-header');
                if (header) {
                    header.addEventListener('click', () => {
                        const isActive = item.classList.contains('active');
                        episodeItems.forEach(i => i.classList.remove('active'));
                        if (!isActive) item.classList.add('active');
                    });
                }
            });
        }

        // ===== ERROR HANDLING =====
        function showError(error) {
            document.getElementById('modalBody').innerHTML = `
                <div class="modal-inner-padding">
                    <h2 class="movie-title">Error</h2>
                    <p class="movie-description">${error}</p>
                </div>`;
        }

        // ===== DOWNLOAD BUTTON HANDLER =====
        document.addEventListener('click', e => {
            const downloadBtn = e.target.closest('.download-btn');
            if (downloadBtn) {
                e.preventDefault();
                if (!downloadBtn.dataset.downloadUrl) return;

                const isPremiumButton = downloadBtn.dataset.premium === 'true';
                const buttonId = downloadBtn.id;
                const downloadUrl = downloadBtn.dataset.downloadUrl;
                const is1080p = downloadUrl.toLowerCase().includes('1080p') || 
                               (downloadBtn.closest('.episode-item') && 
                                downloadBtn.closest('.episode-item').querySelector('.episode-main-text').textContent.toLowerCase().includes('1080p'));
                const isPremiumEpisode = downloadBtn.closest('.episode-item') && 
                                       downloadBtn.closest('.episode-item').querySelector('.episode-main-text').textContent.toLowerCase().includes('[premium]');
                
                if (isPremiumButton || is1080p || isPremiumEpisode) {
                    if (isFromPremiumSite) {
                        window.open(downloadUrl, '_blank');
                    } else {
                        window.open(premiumPurchaseUrl, '_blank');
                    }
                } else {
                    if (downloadBtn.classList.contains('locked-btn')) {
                        window.open(downloadUnlockUrl, '_blank');
                        sessionStorage.setItem(buttonId, 'true');
                        downloadBtn.classList.remove('locked-btn');
                        downloadBtn.innerHTML = '<i class="fas fa-download"></i> Download Now';
                        downloadBtn.href = downloadUrl;
                        downloadBtn.target = "_blank";
                    } else {
                        window.open(downloadUrl, '_blank');
                    }
                }
            }
        });

        // ===== KEYBOARD SHORTCUTS FOR MODALS =====
        document.addEventListener('keydown', e => { 
            if (modal.style.display === 'block' && e.key === 'Escape') {
                e.preventDefault();
                closeModal('movieModal');
                return;
            }
        });

        // ===== SECURITY MEASURES =====
        document.addEventListener('contextmenu', e => e.preventDefault());

        document.onkeydown = e => {
            if (e.keyCode === 123 || 
                (e.ctrlKey && e.shiftKey && (e.keyCode === 73 || e.keyCode === 67 || e.keyCode === 74)) || 
                (e.ctrlKey && (e.keyCode === 85 || e.keyCode === 83 || e.keyCode === 65))) {
                if (['ArrowLeft', 'ArrowRight', 'Space'].includes(e.code)) {
                    return true;
                }
                return false;
            }
        };
    </script>
    
    <!-- ===== URL CLEANUP SCRIPT ===== -->
    <script>
        (function(){
            let url = window.location.toString();
            const paramsToRemove = ["%3D", "&m=1", "?m=1"];
            paramsToRemove.forEach(param => { 
                if(url.includes(param)) url = url.substring(0, url.indexOf(param)); 
            });
            if(window.location.toString() !== url) window.history.replaceState({}, document.title, url);
        })();
    </script>

    <!-- ===== AD SCRIPT ===== -->
    <script>
        (function() {
            if (!adminReferrers.some(referrer => document.referrer.startsWith(referrer))) {
                var script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = '//wildestgraciousunpack.com/03/4c/3b/034c3bbbee8360b5f93ad5decc133f2f.js';
                document.body.appendChild(script);
            }
        })();
    </script>
</body>
</html>
